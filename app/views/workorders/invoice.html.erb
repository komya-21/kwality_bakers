<!DOCTYPE html>
<html>
<section id="main-content" class="animated fadeInUp">
  <div class="row">
    <div class="col-md-12">
      <div class=" panel panel-info">
        <div class="panel-body">
<head>
  <style>
    table {
     width:100%;
   }
   p {
       margin-bottom:0px;
   }
   address{
    display: block;
    width: 300px;
    margin:0px;
    
   }
   table, th, td {
     border: 1px solid black;
     border-collapse: collapse;
     font-size: 12px;
   }
   th, td {
     padding: 2px;
     text-align: left;
   }
   table#t01 tr:nth-child(even) {
     background-color: #eee      }
   table#t01 tr:nth-child(odd) {
    background-color:#fff;
  }
  table#t01 th {
   background-color: black;
   color: white;
 }
 h5 {
   display:inline;
 }
.maindiv{
    width:100%;
}
.leftdiv{
  float:left;
  width:50%;
} 
.rightdiv{
  float:right;
  width:40%;
} 
.centerdiv{
  width:100%;
  margin:0 auto;
}

.maindiv{
    width:100%;
}
.leftdiv{
  float:left;
  width:50%;
} 
.rightdiv{
  float:right;
  width:40%;
} 
.centerdiv{
  width:100%;
  margin:0 auto;
}
p span{
  font-weight:700;
  color:#000;
}
</style>


<style>
table.qr-code {
  width: 100px;
  height: 100px;
  border-width: 0;
  border-style: none;
  border-color: #0000ff;
  border-collapse: collapse;
}
table.qr-code td {
  border-width: 0;
  border-style: none;
  border-color: #0000ff;
  border-collapse: collapse;
  padding: 0;
  margin: 0;
  width: 2px;
  height: 2px;
}
table.qr-code td.black { background-color: #000; }
table.qr-code td.white { background-color: #fff; }

</style>
<div class="centerdiv">
<h3>Invoice</h3>
</div>

<div class="rightdiv">
<h6>ADD:- SR.NO.28/31,NEAR PARI COMPANY,NARHE DHAYARI ROAD,DHAYARI,PUNE.411041.

 <br>
      <b>GST no:</b><br>
     <b> Date&Time:</b><br>
     <b>MO NO:-</b>7350799350<br> 
  <b>MAIL ID:-</b>vikasmulik57@gmail.com</h6>
      
    
    
      <h5> <b>To:</b><%= @workorder.vendor.name if @workorder.vendor.present? %>
      <b>Gst No:</b><%= @workorder.vendor.gst_no if @workorder.vendor.present? %>
    </h5>
    </div>

  
    
   

<div class="maindiv">

<style>
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}
</style>
</head>
<body>
<% k = 0 %>
<% @final_amount = 0 %>
<% @total_amount1 = 0 %>
<% @amt1 = 0 %> 
<% @amt2 = 0 %> 
<% @amt3 = 0 %> 
<% @j = 0%>
<% @workorder.fproducts.each do |f| %>

<% k += 1 %>
<% if k != 1 %>

<% @amt1 = @total_amount %>
<% @amt2 = @full_amt %>

<% @amt3 = @drawer_amount %>
<% end %>

<table style="width:100%">
   <% @letters = ('A'..'Z').to_a %>
   

  <% @uniq_ftypes = f.measurements.all.map{|m| m.ftype}.uniq %>
  <% @m = 0 %>

  <% @uniq_ftypes.each do |u| %>
  <% @m += 1 %>
  
  <% @full_amt = 0 %>
  <% @drawer_amount = 0 %>

  <tr>
    
    <th style="font-size: 16px; background-color: #ccc; width: 75px;" colspan="10"><center><% if @m == 1 %><%= f.product %><br><% end %>(<%= @letters.shift %>)<%= u %></center></th>

    
  </tr>
  <% @i = 0 %>

   <% if u == "Carcass Box" %>

  
   <tr>
    <th>No</th>
    <th>Quantity</th>
    <th>Skirting</th>
    <th>Vertical</th>
    <th>Horizontal</th>
    <th>Sq.ft 18mm</th>
    <th>rate</th>
    <th>Sq.ft8mm(back)</th>
    <th>rate</th>
    <th>AMT</th>
  </tr>
   <% @carcass_measurements = f.measurements.where(ftype: u) %>
    <% @total_no = 0 %>
    <% @total_sqft = 0 %>
    <% @total_sqft_back = 0 %>
    <% @total_amount = 0 %>
    <% @carcass_rate1 = @rates.find_by(["product = ? and ptype=? and ctype = ?",f.product,u,"TB/LR"]) %>
<% @carcass_rate2 = @rates.find_by(["product = ? and ptype=? and ctype = ?",f.product,u,"Back"]) %>
<% @c1 = @carcass_rate1.price %>
<% @c2 = @carcass_rate2.price %>
   <% @carcass_measurements.each do |c| %>
   <% @j+=1 %>
   <% @i += 1 %>
   <% @total_no += c.quantity %>
   <% @sq = ((((c.width*c.depth)/92903)*2)*c.quantity)+((((c.height*c.depth)/92903)*2)*c.quantity) %>
   <% @skirting_sqft = 0 %>
   <% @v_area = 0 %>
   <% @h_area = 0 %>
    <% if c.skirting != nil %>
   <% @s_width = c.width - 36 %>
   <% @skirting_sqft = ((@s_width*c.skirting)/92903)*c.quantity %>
   <% end %>
   <!-- end of calculation of skirting -->
   <% if c.vertical != nil %>
   <% if c.skirting != nil %>
    <% @v_height = c.height-c.skirting-36 %>
    <% else %>
    <% @v_height = c.height-36 %>
     <% end %>
     <% @v_area = ((@v_height * c.depth)/92903)*c.quantity %>

   <% end %>

   <% if c.horizontal != nil %>
   <% @h_width = c.width - 36 %>
   <% @h_area =  ((@h_width*c.depth)/92903)*c.quantity %>
   <% end %>
    
<% @sqft = @sq + @skirting_sqft  + @v_area + @h_area %>
    <% @total_sqft += @sqft %>
   <% @total_sqft += @sqft %>
   <% @sqft_back = ((c.width*c.height)/92903)*c.quantity %>
   <% @total_sqft_back += @sqft_back %>
   <% @tot_amt = (@sqft.round(2)*@c1)+(@sqft_back.round(2)*@c2) %>
   <% @total_amount += @tot_amt %>
   <% @amt1 += @total_amount %>
   <tr>
   <td><%= @i %></td>
  
   
   <td><%= c.quantity %></td>
   <% if c.skirting != nil %>
   <td>Yes</td>
   <% else %>
   <td>No</td>
   <% end %>
   <td><%= c.vertical %></td>
   <td><%= c.horizontal %></td>
   
   <td><%= text_field_tag :"sqft#{@j}" ,@sqft.round(2),disabled: true %></td>
   <td><%= text_field_tag :"rate#{@j}" , @c1 %></td>
   
   <td><%= text_field_tag :"sqft_back#{@j}",@sqft_back.round(2),disabled: true %></td>
   <td><%= text_field_tag :"back_rate#{@j}" , @c2 %></td>
   
   <td><%= text_field_tag :"amount#{@j}" ,@tot_amt.round(2) ,disabled: true%></td>
 </tr>

<% end %>


  
  
  <% end %>

   <% if u == "Drawer" %>
   
    <th>No</th>
    <th>W</th>
    <th>D</th>
    <th>H</th>
    <th>Nos</th>
    <th>Sq.ft</th>
    <th>rate</th>
    <th>AMT</th>
  </tr>
  <% @drawer_measurements = f.measurements.where(ftype: u) %>
    <% @total_no = 0 %>
    <% @total_sqft = 0 %>
    
    
    <% @drawer_rate = @rates.find_by(["product = ? and ptype=?",f.product,u]) %>
    <% @d = @drawer_rate.price %>
    <% @drawer_measurements.each do |c| %>
   <% @i += 1 %>
   <% @total_no += c.quantity %>
   <tr>
   <td><%= @i %></td>
   <td><%= c.width %></td>
   <td><%= c.depth %></td>
   <td><%= c.height %></td>
   <td><%= c.quantity %></td>
   <% @sqft = ((((c.height*c.depth)/92903)*2)*c.quantity)+((((c.height*c.width)/92903)*2)*c.quantity)+(((c.width*c.depth)/92903)*c.quantity) %>
   <% @total_sqft += @sqft %>
   <td><%= @sqft.round(2) %></td>
   <td><%= @d %></td>
  
   <% @d_tot_amt = (@sqft.round(2)*@d) %>
   <% @drawer_amount += @d_tot_amt %>
   <% @amt3 += @drawer_amount %>
   <td><%= @d_tot_amt.round(2) %></td>
 </tr>

 <% end %>
 <% end %>
  
 



   <% if u == "Shutters" || u == "White BSL Shelf" || u =="Hinges Patti" %>
   <tr>
    <th>No</th>
    
    <th>Quantity</th>
    <th>Sq.ft</th>
    <th>rate</th>
    <th>AMT</th>
    
  </tr>
   
  <!-- Calculations of rates -->
  <% if u == "Shutters" %>
  <% @shutter_rate = @rates.find_by(["product = ? and ptype=? ",f.product,u])%>
  <% @sr = @shutter_rate.price %>
  <% elsif u == "White BSL Shelf" %>
  <% @wbs_rate = @rates.find_by(["product = ? and ptype=? ",f.product,u])%>
  <% @sr = @wbs_rate.price %>
  <% elsif u == "Hinges Patti" %>
  <% @hp_rate = @rates.find_by(["product = ? and ptype=? ",f.product,u])%>
  <% @sr = @hp_rate.price %>
  <% end %>
  <!-- End of calculation -->
  <% @shutter_measurements = f.measurements.where(ftype: u ) %>
  <% @tot_sqrft = 0 %>
  <% @tot_num = 0 %>
  
   <% @shutter_measurements.each do |c| %>
  <% @tot_num += c.quantity %>
   <% @sqrft = ((c.width*c.height)/92903)*c.quantity %>
   
   <% @tot_sqrft += @sqrft %>
   <% @t_amt = @sqrft.round(2)*@sr.round(2) %>

   <% @full_amt += @t_amt %>
   <% if k != 1 %>
   <% @amt2 += @full_amt %>
   <% end %>
   <% @i += 1 %>
   
   <tr>
   <td><%= @i %></td>
   <td><%= @tot_num %></td>
   
   
  
   <td><%= @tot_sqrft.round(2) %></td>
   <td><%= @sr %></td>
   

   <td><%= @full_amt.round(2) %></td>
   
   
  

  </tr>
  
  <% end %>
  <% end %>
  
  
 

 
  
 
  
  

  
  
    
 
  
<% end %>
<% end %>

<tr><th colspan="9">Total</th>

  <% @amt = @amt1 + @amt2 + @amt3 %>
  
  <% @final_amount += @amt %>
<th><b><%= @final_amount.round(2) %></b></th></tr>
<tr><th colspan="9">CGST(9%)</th>

  <% @cgst = (@final_amount *9)/100 %>
  

  
  <th><%= @cgst.round(2) %></th>
  </tr>
  <tr><th colspan="9">SGST(9%)</th>

  
  <% @sgst = (@final_amount *9)/100 %>

  
  <th><%= @sgst.round(2) %></th>
  </tr>
  <tr  style="background-color: #F0E68C;"><th colspan="9">Total To Pay</th>
  <% @pay = @final_amount.round(2)+@cgst.round(2)+@sgst.round(2)%>
  
  
<th><b><%= @pay.round(2) %></b></th></tr>

   
</table>
<br><br>
 <%= link_to 'Generate Invoice ',workorder_invoice_workorder_path(@workorder, format: 'pdf'),target: '_blank', class: "btn btn-success"%> 
<%= link_to "Back" ,workorder_path(@workorder.id),class: "btn btn-default" %>
<br><br>

</body>
</div>
</head>
</div>
</div>
</div>
</div>
</section>
</html>
<% content_for :javascript do %>




<script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
   

  $(document).on("keyup", "#rate1", function() {
    var rate = $('#rate1').val();
    
    var back_rate = $('#back_rate1').val();
    var sqft = $('#sqft1').val();
    var sqft_back = $('#sqft_back1').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount1').val(total);

    
  });
  </script>
  <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
   

  $(document).on("keyup", "#rate2", function() {
    var rate = $('#rate2').val();
    
    var back_rate = $('#back_rate2').val();
    var sqft = $('#sqft2').val();
    var sqft_back = $('#sqft_back2').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount2').val(total);

    
  });
  </script>
  <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
   

  $(document).on("keyup", "#rate3", function() {
    var rate = $('#rate3').val();
    
    var back_rate = $('#back_rate3').val();
    var sqft = $('#sqft3').val();
    var sqft_back = $('#sqft_back3').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount3').val(total);

    
  });
  </script>
  <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
   

  $(document).on("keyup", "#rate4", function() {
    var rate = $('#rate4').val();
    
    var back_rate = $('#back_rate4').val();
    var sqft = $('#sqft4').val();
    var sqft_back = $('#sqft_back4').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount4').val(total);

    
  });
  </script>

  <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
     
  $(document).on("keyup", "#back_rate1", function() {
    var rate = $('#rate1').val();
    var back_rate = $('#back_rate1').val();
    var sqft = $('#sqft1').val();
    var sqft_back = $('#sqft_back1').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount1').val(total);
    
  });
  </script>
   <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
     
  $(document).on("keyup", "#back_rate2", function() {
    var rate = $('#rate2').val();
    var back_rate = $('#back_rate2').val();
    var sqft = $('#sqft2').val();
    var sqft_back = $('#sqft_back2').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount2').val(total);
    
  });
  </script>
   <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
     
  $(document).on("keyup", "#back_rate3", function() {
    var rate = $('#rate3').val();
    var back_rate = $('#back_rate3').val();
    var sqft = $('#sqft3').val();
    var sqft_back = $('#sqft_back3').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount3').val(total);
    
  });
  </script>
   <script type="text/javascript">
    // $(document).ready(function(){
    //   $("#")
    // })
     
  $(document).on("keyup", "#back_rate4", function() {
    var rate = $('#rate4').val();
    var back_rate = $('#back_rate4').val();
    var sqft = $('#sqft4').val();
    var sqft_back = $('#sqft_back4').val();
    var total = (sqft*rate)+(sqft_back * back_rate);
    $('#amount4').val(total);
    
  });
  </script>
  <% end %>